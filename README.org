#+OPTIONS: toc:nil num:nil author:nil creator:nil \n:nil |:t
#+OPTIONS: @:t ::t ^:t -:t f:t *:t <:t

* Emacs連動メモ管理アプリ

  - [[https://travis-ci.org/akicho8/memo_station][Travis]]: [[https://travis-ci.org/akicho8/memo_station.png]]
  - [[https://gemnasium.com/akicho8/memo_station/][Gemnasium]]: [[https://gemnasium.com/akicho8/memo_station.png]]
  - [[https://codeclimate.com/github/akicho8/memo_station][Code Climate]]: [[https://codeclimate.com/github/akicho8/memo_station.png]]

** セットアップ

   : setup
   : rails s
   : open http://localhost:3000/

** デプロイ

   : cap production deploy

** Emacsインタフェースの設定(例)

   memo_station.el を読めるようにする

   : ln -s ~/src/memo_station/lib/memo_station.el ~/.emacs.d/lib

   [[https://github.com/tkf/emacs-request][request.el]] が入っていなけれインストール

   : M-x package-list-packages

   curl もインストール

   : brew install curl
   : brew link curl

   ~/.emacs.d/init.el に以下を設定

   : (require 'memo-station)
   : (setq memo-station-url "http://memo/")
   : (global-unset-key "\C-j")
   : (global-set-key (kbd "C-j w") 'memo-station-create)
   : (global-set-key (kbd "C-j s") 'memo-station-search)

** Docker Setup

   コンテナ作成

   : docker-compose build

   コンテナ起動

   : docker-compose up -d

   VirtualBoxにポートフォワーディング設定を追加

   : VBoxManage controlvm [docker image] natpf1 "nginx,tcp,127.0.0.1,8080,,80"

   migrationを実行

   : docker-compose run rails rake db:migrate

   hostsに以下を追加

   : 127.0.0.1 memo_station.local

   アクセス

   : http://memo_station.local:8080

   sqlite3データファイルをローカルにコピー (ローカルパスをマウントしてコピーしている)

   : docker run --volumes-from memostation_rails_1 -v $(pwd):/backup busybox cp /data/memo_station_production.sqlite3 /backup/

   Volume内sqliteデータのバックアップリストア

   : docker run -i -t --volumes-from memostation_rails_1 -v $(pwd):/backup busybox /bin/sh
   : # cp /backup/memo_station_production.sqlite3 /data/memo_station_production.sqlite3
